<!doctype html>
<html lang="fi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Idle Clicker Pro - Smooth Edition</title>
  <style>
    :root{
      --radius: 16px;
      --bg1:#0b1020;
      --bg2:#0b1d2d;
      --text:#e9eefc;
      --muted:#a8b3d6;
      --accent:#7c3aed;
      --accent2:#22c55e;
      --warn:#f59e0b;
      --danger:#ef4444;
      --common:#94a3b8;
      --rare:#38bdf8;
      --epic:#c084fc;
      --border: rgba(255,255,255,.10);
    }

    *{ box-sizing:border-box; }

    body{
      font-family: system-ui, -apple-system, sans-serif;
      max-width: 900px;
      margin: 30px auto;
      padding: 0 16px;
      color: var(--text);
      background: linear-gradient(180deg, var(--bg1), var(--bg2));
      min-height: 100vh;
    }

    .card{
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 16px;
      margin: 12px 0;
      background: rgba(255,255,255,.03);
      backdrop-filter: blur(4px);
    }

    .row{ display:flex; gap: 12px; flex-wrap: wrap; align-items:center; }
    .big{ font-size: 24px; font-weight: 900; letter-spacing: -0.5px; }
    .muted{ color: var(--muted); font-size: 14px; }

    .chip{
      padding: 6px 12px; border-radius: 999px; 
      background: rgba(255,255,255,.05); border: 1px solid var(--border);
      font-weight: 700; font-size: 13px;
    }

    button{
      padding: 12px 16px; border-radius: 12px; border: 1px solid rgba(255,255,255,.1);
      cursor: pointer; background: rgba(255,255,255,.08); color: var(--text);
      font-weight: 700; transition: transform 0.1s, background 0.2s;
    }
    button:hover:not(:disabled){ background: rgba(255,255,255,.15); }
    button:active:not(:disabled){ transform: scale(0.96); }
    button:disabled{ opacity: 0.3; cursor: not-allowed; }

    .btnGood{ background: var(--accent2); color: #000; border: none; }
    .btnPrimary{ background: var(--accent); color: #fff; border: none; }

    /* Kaupan gridi ilman v√§lkkymist√§ */
    .shopGrid{ 
      display:grid; 
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); 
      gap: 12px; 
      margin-top: 12px; 
    }
    
    .item{
      border: 1px solid var(--border); border-radius: var(--radius); padding: 16px;
      background: rgba(255,255,255,0.02); display: flex; flex-direction: column; gap: 10px;
    }

    .pill{ border-radius: 999px; padding: 6px 16px; font-size: 12px; }
    .pill.active{ background: var(--rare); color: #000; }

    .progressBar{ height: 8px; border-radius: 999px; background: rgba(0,0,0,.3); overflow:hidden; margin: 10px 0; }
    .progressFill{ height:100%; width:0%; background: var(--rare); transition: width 0.3s ease; }

    .pop{ position:fixed; pointer-events:none; font-weight: 900; color: var(--accent2); animation: popAnim 0.8s ease-out forwards; z-index: 1000; }
    @keyframes popAnim{ 0%{opacity:1; transform:translateY(0);} 100%{opacity:0; transform:translateY(-50px);} }
  </style>
</head>
<body>

<div class="card">
  <div class="muted">Saldo</div>
  <div class="big" id="coins">0</div>
  <div class="row" style="margin-top:10px">
    <span class="chip">üñ±Ô∏è <span id="perClick">1</span> / klik</span>
    <span class="chip">‚öôÔ∏è <span id="perSec">0</span> / s</span>
  </div>
</div>

<div class="card row" style="justify-content: center; padding: 30px;">
  <button id="clickBtn" class="btnGood" style="width: 200px; height: 60px; font-size: 18px;">KLIKKAA!</button>
  <button id="buyClickBtn" class="btnPrimary">P√§ivit√§ klikkaus (<span id="clickCost">25</span>)</button>
</div>

<div class="card">
  <div class="row" style="justify-content: space-between;">
    <div class="big">Kauppa</div>
    <div class="row">
      <button class="pill active" id="btnX1">x1</button>
      <button class="pill" id="btnX10">x10</button>
    </div>
  </div>
  <div id="shopGrid" class="shopGrid"></div>
</div>

<div class="card row" style="border:none; background:none; justify-content: space-between;">
    <div class="muted">Prestige pisteet: <span id="prestigePts">0</span></div>
    <div class="row">
        <button id="saveBtn" style="font-size: 12px;">Tallenna</button>
        <button id="resetBtn" style="font-size: 12px; color: var(--danger);">Nollaa</button>
    </div>
</div>

<script>
(() => {
  "use strict";

  let coins = 0;
  let perClick = 1;
  let clickUpgradeCost = 25;
  let prestigePoints = 0;
  let buyMode = 1;
  
  let buildings = [
    { id: "b1", name: "Automaatti", baseCost: 15, baseCps: 1, owned: 0 },
    { id: "b2", name: "Tehdas", baseCost: 150, baseCps: 10, owned: 0 },
    { id: "b3", name: "Mega-Yhti√∂", baseCost: 1500, baseCps: 50, owned: 0 }
  ];

  const fmt = n => n >= 1000 ? (n/1000).toFixed(1) + "k" : Math.floor(n);
  const getMult = () => 1 + (prestigePoints * 0.1);
  const getCps = () => buildings.reduce((s, b) => s + (b.owned * b.baseCps), 0) * getMult();

  // Luodaan kaupan elementit VAIN KERRAN alussa
  const initShop = () => {
    const grid = document.getElementById("shopGrid");
    grid.innerHTML = "";
    buildings.forEach(b => {
      const div = document.createElement("div");
      div.className = "item";
      div.id = `item-${b.id}`;
      div.innerHTML = `
        <div style="display:flex; justify-content:space-between"><b>${b.name}</b> <span id="count-${b.id}">0</span></div>
        <div class="muted" id="cps-${b.id}">+0/s</div>
        <button id="buy-${b.id}" onclick="window.buyB('${b.id}')">Ladataan...</button>
      `;
      grid.appendChild(div);
    });
  };

  // P√§ivitet√§√§n vain tekstit, ei koko HTML-rakennetta
  const updateUI = () => {
    document.getElementById("coins").textContent = fmt(coins);
    document.getElementById("perClick").textContent = fmt(perClick * getMult());
    document.getElementById("perSec").textContent = fmt(getCps());
    document.getElementById("clickCost").textContent = fmt(clickUpgradeCost);
    document.getElementById("buyClickBtn").disabled = coins < clickUpgradeCost;

    buildings.forEach(b => {
      const cost = Math.ceil(b.baseCost * Math.pow(1.15, b.owned) * (buyMode === 10 ? 20.3 : 1)); 
      // Huom: 10kpl hinta on yksinkertaistettu kaavalla
      
      const btn = document.getElementById(`buy-${b.id}`);
      const countLabel = document.getElementById(`count-${b.id}`);
      const cpsLabel = document.getElementById(`cps-${b.id}`);

      countLabel.textContent = b.owned;
      cpsLabel.textContent = "+" + fmt(b.baseCps * getMult()) + "/s";
      btn.textContent = `Osta ${buyMode}x (${fmt(cost)})`;
      btn.disabled = coins < cost;
    });
  };

  window.buyB = (id) => {
    const b = buildings.find(x => x.id === id);
    const cost = Math.ceil(b.baseCost * Math.pow(1.15, b.owned) * (buyMode === 10 ? 20.3 : 1));
    if (coins >= cost) {
      coins -= cost;
      b.owned += buyMode;
      updateUI();
    }
  };

  document.getElementById("clickBtn").onclick = (e) => {
    const gain = perClick * getMult();
    coins += gain;
    
    // Klikkaus-efekti
    const pop = document.createElement("div");
    pop.className = "pop";
    pop.textContent = "+" + fmt(gain);
    pop.style.left = e.clientX + "px";
    pop.style.top = e.clientY + "px";
    document.body.appendChild(pop);
    setTimeout(() => pop.remove(), 800);
    
    updateUI();
  };

  document.getElementById("buyClickBtn").onclick = () => {
    if (coins >= clickUpgradeCost) {
      coins -= clickUpgradeCost;
      perClick++;
      clickUpgradeCost = Math.ceil(clickUpgradeCost * 1.8);
      updateUI();
    }
  };

  document.getElementById("btnX1").onclick = () => { buyMode = 1; updatePills("btnX1"); };
  document.getElementById("btnX10").onclick = () => { buyMode = 10; updatePills("btnX10"); };
  
  const updatePills = (activeId) => {
    document.querySelectorAll(".pill").forEach(p => p.classList.remove("active"));
    document.getElementById(activeId).classList.add("active");
    updateUI();
  };

  // Tallennus ja nollaus
  document.getElementById("saveBtn").onclick = () => {
    localStorage.setItem("idle_save", JSON.stringify({coins, perClick, buildings, prestigePoints, clickUpgradeCost}));
    alert("Tallennettu!");
  };
  
  document.getElementById("resetBtn").onclick = () => {
    if(confirm("Haluatko varmasti nollata kaiken?")) {
      localStorage.clear();
      location.reload();
    }
  };

  // Pelisilmukka
  initShop();
  
  // Laskenta tapahtuu 100ms v√§lein (tasainen kertyminen)
  setInterval(() => {
    coins += getCps() / 10;
  }, 100);

  // K√§ytt√∂liittym√§ p√§ivittyy vain 5 kertaa sekunnissa (est√§√§ "s√§ken√∂innin")
  setInterval(updateUI, 200);

})();
</script>
</body>
</html>
