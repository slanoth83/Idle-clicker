<!doctype html>
<html lang="fi">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Idle Clicker</title>

<style>
body{font-family:system-ui,Arial;max-width:980px;margin:40px auto;padding:0 16px}
h1{margin:0 0 12px}
.card{border:1px solid #ddd;border-radius:14px;padding:16px;margin:12px 0;background:#fff}
.row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
.big{font-size:22px;font-weight:900}
.muted{color:#666}
.small{font-size:13px}
button{padding:12px 14px;border-radius:12px;border:1px solid #ccc;background:#fff;font-weight:700;cursor:pointer}
button:disabled{opacity:.55;cursor:not-allowed}
.progressBar{height:10px;border-radius:999px;background:#f2f2f2;overflow:hidden;border:1px solid #e6e6e6}
.progressFill{height:100%;width:0%;background:#cfcfcf;transition:width .2s linear}
</style>
</head>

<body>

<h1>Idle Clicker</h1>

<div class="card">
  <div class="big">Kolikot: <span id="coins">0</span></div>
  <div class="muted">Per klikki: <span id="perClick">1</span> | CPS: <span id="perSec">0</span></div>
</div>

<div class="card row">
  <button id="clickBtn">Klikkaa</button>
  <button id="saveBtn">Save</button>
  <button id="resetBtn">Reset</button>
</div>

<!-- QUEST -->
<div class="card">
  <div class="big">Quest</div>
  <div id="questText" class="muted">-</div>

  <div class="progressBar" style="margin-top:8px">
    <div class="progressFill" id="questFill"></div>
  </div>

  <div class="row" style="margin-top:10px">
    <button id="claimQuestBtn">Lunasta palkinto</button>
    <div class="muted small" id="questCooldown">-</div>
  </div>
</div>

<script>
(() => {
"use strict";

/* ===== STATE ===== */
let coins=0, perClick=1;
let totalClicks=0;

/* ===== QUEST ===== */
const QUEST_COOLDOWN = 60*60; // 1h
let quest = null;
/*
 quest = {
   type, target, progress,
   rewardCoins,
   rewardSeconds,
   readyAt
 }
*/

/* ===== BUILDINGS (kevyt tässä esimerkissä) ===== */
const buildings=[
 {id:"b1",name:"Työläinen",baseCps:1,owned:0},
 {id:"b2",name:"Tehdas",baseCps:8,owned:0}
];

/* ===== HELPERS ===== */
const fmt=n=>n>=1e6?(n/1e6).toFixed(1)+"M":n>=1e3?(n/1e3).toFixed(1)+"K":Math.floor(n);
const cps=()=>buildings.reduce((s,b)=>s+b.owned*b.baseCps,0);

/* ===== QUEST LOGIC ===== */
function generateQuest(){
 const r=Math.random();
 const curCps=Math.max(1,cps());

 if(r<0.25){
  return {
    type:"click",
    text:"Klikkaa 100 kertaa",
    target:100,
    progress:0,
    rewardCoins:curCps*300,
    rewardSeconds:300,
    readyAt:0
  };
 }
 if(r<0.5){
  return {
    type:"coins",
    text:"Ansaitse 5K kolikkoa",
    target:5000,
    progress:0,
    rewardCoins:curCps*500,
    rewardSeconds:300,
    readyAt:0
  };
 }
 if(r<0.75){
  return {
    type:"buildings",
    text:"Osta 5 rakennusta",
    target:5,
    progress:0,
    rewardCoins:curCps*600,
    rewardSeconds:300,
    readyAt:0
  };
 }
 return {
   type:"factory",
   text:"Osta 3 Tehdasta",
   target:3,
   progress:0,
   rewardCoins:curCps*800,
   rewardSeconds:300,
   readyAt:0
 };
}

function updateQuestProgress(){
 if(!quest || quest.readyAt>0) return;

 if(quest.type==="click") quest.progress=Math.min(quest.target,totalClicks);
 if(quest.type==="coins") quest.progress=Math.min(quest.target,coins);
 if(quest.type==="buildings") quest.progress=Math.min(quest.target,buildings.reduce((s,b)=>s+b.owned,0));
 if(quest.type==="factory"){
  const f=buildings.find(b=>b.id==="b2");
  quest.progress=Math.min(quest.target,f?f.owned:0);
 }
}

function canClaimQuest(){
 return quest && quest.progress>=quest.target && quest.readyAt===0;
}

function claimQuest(){
 if(!canClaimQuest()) return;
 coins+=quest.rewardCoins;
 coins+=quest.rewardSeconds*cps(); // instant idle boost
 quest.readyAt=Math.floor(Date.now()/1000)+QUEST_COOLDOWN;
}

/* ===== UI ===== */
const elCoins=document.getElementById("coins");
const elPerClick=document.getElementById("perClick");
const elPerSec=document.getElementById("perSec");
const elQuestText=document.getElementById("questText");
const elQuestFill=document.getElementById("questFill");
const elQuestCd=document.getElementById("questCooldown");
const claimBtn=document.getElementById("claimQuestBtn");

function updateUI(){
 elCoins.textContent=fmt(coins);
 elPerClick.textContent=perClick;
 elPerSec.textContent=fmt(cps());

 if(!quest){
  elQuestText.textContent="Uusi questi luodaan...";
  elQuestFill.style.width="0%";
  claimBtn.disabled=true;
  return;
 }

 elQuestText.textContent=`${quest.text} (${quest.progress}/${quest.target})`;
 elQuestFill.style.width=Math.min(100,(quest.progress/quest.target)*100)+"%";

 if(quest.readyAt>0){
  const left=Math.max(0,quest.readyAt-Math.floor(Date.now()/1000));
  if(left===0){
    quest=generateQuest();
  }else{
    elQuestCd.textContent=`Cooldown: ${Math.ceil(left/60)} min`;
    claimBtn.disabled=true;
    return;
  }
 }

 elQuestCd.textContent=`Palkinto: +${fmt(quest.rewardCoins)} kolikkoa`;
 claimBtn.disabled=!canClaimQuest();
}

/* ===== EVENTS ===== */
document.getElementById("clickBtn").onclick=()=>{
 coins+=perClick;
 totalClicks++;
 updateQuestProgress();
};

claimBtn.onclick=()=>{
 claimQuest();
};

/* ===== SAVE ===== */
function save(){
 localStorage.setItem("idle_clicker_quest",JSON.stringify({
  coins,perClick,totalClicks,quest,savedAt:Date.now()
 }));
}

function load(){
 const raw=localStorage.getItem("idle_clicker_quest");
 if(!raw){ quest=generateQuest(); return; }
 const d=JSON.parse(raw);
 coins=d.coins||0;
 perClick=d.perClick||1;
 totalClicks=d.totalClicks||0;
 quest=d.quest||generateQuest();
}

/* ===== TIMERS ===== */
setInterval(()=>{ coins+=cps()/10; updateQuestProgress(); },100);
setInterval(updateUI,200);
setInterval(save,10000);

/* ===== START ===== */
load();
updateUI();

})();
</script>

</body>
</html>
