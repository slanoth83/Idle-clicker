<!doctype html>
<html lang="fi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Idle Clicker Pro</title>
  <style>
    :root{
      --radius: 16px;
      --bg1:#0b1020;
      --bg2:#0b1d2d;
      --text:#e9eefc;
      --muted:#a8b3d6;
      --accent:#7c3aed;
      --accent2:#22c55e;
      --warn:#f59e0b;
      --danger:#ef4444;
      --common:#94a3b8;
      --rare:#38bdf8;
      --epic:#c084fc;
      --border: rgba(255,255,255,.10);
      --shadow2: 0 10px 24px rgba(0,0,0,.28);
    }

    *{ box-sizing:border-box; }

    body{
      font-family: system-ui, -apple-system, Segoe UI, Arial, sans-serif;
      max-width: 980px;
      margin: 34px auto;
      padding: 0 16px;
      color: var(--text);
      background:
        radial-gradient(900px 500px at 10% 10%, rgba(124,58,237,.22), transparent 60%),
        radial-gradient(800px 500px at 90% 0%, rgba(56,189,248,.18), transparent 60%),
        radial-gradient(900px 700px at 60% 90%, rgba(34,197,94,.16), transparent 60%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      min-height: 100vh;
    }

    .card{
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 16px;
      margin: 12px 0;
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      box-shadow: var(--shadow2);
      backdrop-filter: blur(6px);
    }

    .row{ display:flex; gap: 12px; flex-wrap: wrap; align-items:center; }
    .big{ font-size: 22px; font-weight: 950; }
    .muted{ color: var(--muted); }
    .small{ font-size: 13px; }

    .chip{
      display:inline-flex; align-items:center; gap: 8px; padding: 6px 10px;
      border-radius: 999px; border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04); font-weight: 800; color: var(--text);
    }
    .dot{ width: 8px; height: 8px; border-radius: 99px; background: var(--accent2); box-shadow: 0 0 16px rgba(34,197,94,.45); }
    .dot.blue{ background: #38bdf8; box-shadow: 0 0 16px rgba(56,189,248,.45); }

    button{
      padding: 12px 14px; border-radius: 14px; border: 1px solid rgba(255,255,255,.14);
      cursor: pointer; background: rgba(255,255,255,.06); color: var(--text);
      font-weight: 850; transition: all .1s ease;
    }
    button:hover:not(:disabled){ background: rgba(255,255,255,.12); transform: translateY(-1px); }
    button:active:not(:disabled){ transform: translateY(1px) scale(.98); }
    button:disabled{ opacity: .4; cursor: not-allowed; }

    .btnPrimary{ background: var(--accent); }
    .btnGood{ background: var(--accent2); color: #000; }
    .btnWarn{ background: var(--warn); color: #000; }
    .btnDanger{ background: var(--danger); }

    .shopGrid{ display:grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 12px; margin-top: 12px; }
    .item{
      border: 1px solid var(--border); border-radius: var(--radius); padding: 16px;
      background: rgba(255,255,255,0.03); display: flex; flex-direction: column; gap: 8px;
    }

    .pill{ border-radius: 999px; padding: 6px 14px; font-size: 13px; }
    .pill.active{ background: var(--rare); color: #000; border-color: var(--rare); }

    .progressBar{ height: 10px; border-radius: 999px; background: rgba(255,255,255,.08); overflow:hidden; margin: 8px 0; }
    .progressFill{ height:100%; width:0%; background: linear-gradient(90deg, var(--rare), var(--accent)); transition: width 0.3s ease; }

    .pop{ position:absolute; pointer-events:none; font-weight: 950; animation: popAnim 0.7s ease-out forwards; color: var(--accent2); }
    @keyframes popAnim{ 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-40px); } }

    .questChoice{ border: 1px solid var(--border); padding: 12px; border-radius: 12px; background: rgba(255,255,255,0.03); }
    .tagCommon{ color: var(--common); } .tagRare{ color: var(--rare); } .tagEpic{ color: var(--epic); }

    #fxCanvas{ position: fixed; inset: 0; pointer-events: none; z-index: 999; }
  </style>
</head>
<body>

<canvas id="fxCanvas"></canvas>

<h1>Idle Clicker Pro</h1>

<div class="card">
  <div class="big">Kolikot: <span id="coins">0</span></div>
  <div class="row" style="margin-top:8px">
    <span class="chip"><span class="dot"></span> Per klikki: <span id="perClick">1</span></span>
    <span class="chip"><span class="dot blue"></span> Per sekunti: <span id="perSec">0</span></span>
  </div>
</div>

<div class="card row">
  <div style="position:relative; display:inline-block;" id="clickArea">
    <button id="clickBtn" class="btnGood" style="padding: 20px 40px; font-size: 1.2rem;">KLIKKAA!</button>
    <div id="popContainer"></div>
  </div>
  <button id="buyClickBtn" class="btnPrimary">Päivitä Klikkaus (<span id="clickCost">25</span>)</button>
  <div class="muted small">Tasot: <span id="clickUps">0</span></div>
</div>

<div class="card">
  <div class="row" style="justify-content: space-between;">
    <div class="big">Questi</div>
    <div id="questCooldown" class="muted small"></div>
  </div>
  <div id="questText" style="margin-top:8px">Valitse tehtävä alta...</div>
  <div class="progressBar"><div class="progressFill" id="questFill"></div></div>
  <div id="questHint" class="muted small">-</div>
  <div id="questChoicesWrap" class="shopGrid"></div>
  <button id="claimQuestBtn" class="btnWarn" style="margin-top:10px" disabled>Lunasta Palkinto</button>
</div>

<div class="card">
  <div class="row" style="justify-content: space-between;">
    <div class="big">Kauppa</div>
    <div class="row">
      <button class="pill active" id="btnX1">x1</button>
      <button class="pill" id="btnX10">x10</button>
      <button class="pill" id="btnMax">MAX</button>
    </div>
  </div>
  <div id="tierBox" class="card" style="background: rgba(245,158,11,0.1); border-color: var(--warn); display:none;">
    <div class="row" style="justify-content: space-between;">
      <div>
        <div id="tierUnlockTitle" font-weight:bold>Avaa uusi rakennus</div>
        <div id="tierUnlockHint" class="small muted"></div>
      </div>
      <button id="buyTierBtn" class="btnWarn">Avaa (<span id="tierUnlockCost">0</span>)</button>
    </div>
  </div>
  <div id="shopGrid" class="shopGrid"></div>
</div>

<div class="card row">
  <div>
    <div class="big">Prestige: <span id="prestigePts">0</span></div>
    <div class="muted small">Kerroin: x<span id="prestigeMult">1.00</span></div>
  </div>
  <button id="prestigeBtn" class="btnPrimary">Prestige (saat +<span id="prestigeGain">0</span>)</button>
  <button id="saveBtn">Tallenna</button>
  <button id="resetBtn" class="btnDanger">Nollaa peli</button>
</div>

<script>
(() => {
  "use strict";

  let coins = 0;
  let perClick = 1;
  let clickUpgrades = 0;
  let clickUpgradeCost = 25;
  let prestigePoints = 0;
  let totalClicks = 0;
  let lifetimeEarned = 0;
  let buyMode = "x1";
  let manualUnlocked = {};
  
  let buildings = [
    { id: "b1", name: "Klikkeri", baseCost: 15, baseCps: 1, owned: 0 },
    { id: "b2", name: "Työpaja", baseCost: 150, baseCps: 8, owned: 0 },
    { id: "b3", name: "Tehdas", baseCost: 1500, baseCps: 45, owned: 0 },
    { id: "b4", name: "Voimala", baseCost: 12000, baseCps: 200, owned: 0 },
    { id: "b5", name: "Pörssi", baseCost: 150000, baseCps: 1200, owned: 0 }
  ];

  let questState = { active: null, choices: null, readyAt: 0 };
  const SAVE_KEY = "idle_pro_save_v1";

  const fmt = n => n >= 1000000 ? (n/1000000).toFixed(2) + "M" : n >= 1000 ? (n/1000).toFixed(1) + "k" : Math.floor(n);
  const getMult = () => 1 + (prestigePoints * 0.05);
  const getCps = () => buildings.reduce((s, b) => s + (b.owned * b.baseCps), 0);
  const costOfN = (b, n) => Math.ceil(b.baseCost * Math.pow(1.15, b.owned) * (Math.pow(1.15, n) - 1) / (1.15 - 1));

  function isUnlocked(idx) {
    if (idx === 0) return true;
    if (manualUnlocked[buildings[idx].id]) return true;
    return buildings[idx-1].owned >= 10;
  }

  // ALUSTETAAN KAUPPA KERRAN (Poistaa säkenöinnin)
  const initShop = () => {
    const grid = document.getElementById("shopGrid");
    grid.innerHTML = "";
    buildings.forEach(b => {
      const div = document.createElement("div");
      div.className = "item";
      div.id = `item-container-${b.id}`;
      div.style.display = "none";
      div.innerHTML = `
        <div class="row" style="justify-content:space-between"><b id="name-${b.id}">${b.name}</b> <span id="owned-${b.id}">0</span></div>
        <div class="small muted" id="cps-${b.id}">0/s</div>
        <button id="buy-btn-${b.id}" onclick="window.buyB('${b.id}')">Osta</button>
      `;
      grid.appendChild(div);
    });
  };

  function updateUI() {
    const mult = getMult();
    document.getElementById("coins").textContent = fmt(coins);
    document.getElementById("perClick").textContent = fmt(perClick * mult);
    document.getElementById("perSec").textContent = fmt(getCps() * mult);
    document.getElementById("clickCost").textContent = fmt(clickUpgradeCost);
    document.getElementById("clickUps").textContent = clickUpgrades;
    document.getElementById("prestigePts").textContent = prestigePoints;
    document.getElementById("prestigeMult").textContent = mult.toFixed(2);
    document.getElementById("prestigeGain").textContent = Math.floor(Math.sqrt(lifetimeEarned / 10000));

    buildings.forEach((b, idx) => {
      const container = document.getElementById(`item-container-${b.id}`);
      if (isUnlocked(idx)) {
        container.style.display = "flex";
        const count = buyMode === "x10" ? 10 : 1;
        const cost = buyMode === "max" ? costOfN(b, 1) : costOfN(b, count);
        document.getElementById(`owned-${b.id}`).textContent = b.owned;
        document.getElementById(`cps-${b.id}`).textContent = fmt(b.baseCps * mult) + "/s";
        const btn = document.getElementById(`buy-btn-${b.id}`);
        btn.textContent = `Osta ${buyMode} (${fmt(cost)})`;
        btn.disabled = coins < cost;
      } else {
        container.style.display = "none";
      }
    });

    const nextIdx = buildings.findIndex((_, i) => !isUnlocked(i));
    const tBox = document.getElementById("tierBox");
    if (nextIdx !== -1) {
      tBox.style.display = "block";
      const cost = buildings[nextIdx].baseCost * 2;
      document.getElementById("tierUnlockTitle").textContent = `Avaa ${buildings[nextIdx].name}`;
      document.getElementById("tierUnlockHint").textContent = `Tarvitset 10kpl: ${buildings[nextIdx-1].name}`;
      document.getElementById("tierUnlockCost").textContent = fmt(cost);
      document.getElementById("buyTierBtn").onclick = () => {
        if (coins >= cost) { coins -= cost; manualUnlocked[buildings[nextIdx].id] = true; updateUI(); }
      };
    } else { tBox.style.display = "none"; }

    const qWrap = document.getElementById("questChoicesWrap");
    if (questState.active) {
      qWrap.innerHTML = "";
      const q = questState.active;
      let prog = q.type === "click" ? (totalClicks - q.baseline) : (lifetimeEarned - q.baseline);
      let perc = Math.min(100, (prog / q.target) * 100);
      document.getElementById("questText").textContent = q.title;
      document.getElementById("questFill").style.width = perc + "%";
      document.getElementById("questHint").textContent = `${fmt(prog)} / ${fmt(q.target)}`;
      document.getElementById("claimQuestBtn").disabled = prog < q.target;
    } else if (Date.now() < questState.readyAt) {
      qWrap.innerHTML = "";
      document.getElementById("questText").textContent = "Odotetaan uusia tehtäviä...";
      document.getElementById("questCooldown").textContent = Math.ceil((questState.readyAt - Date.now())/1000) + "s";
    } else {
      if (!questState.choices) generateQuests();
      qWrap.innerHTML = "";
      questState.choices.forEach(c => {
        const d = document.createElement("div");
        d.className = "questChoice";
        d.innerHTML = `<div class="tag${c.rarity}">${c.rarity}</div><div>${c.title}</div><button onclick="startQ(${c.id})">Valitse</button>`;
        qWrap.appendChild(d);
      });
    }
  }

  function generateQuests() {
    const cps = Math.max(1, getCps());
    questState.choices = [
      { id: Math.random(), title: `Klikkaa 50 kertaa`, type: "click", target: 50, reward: cps * 100, rarity: "Common" },
      { id: Math.random(), title: `Kerää ${fmt(cps*200)} kolikkoa`, type: "earn", target: cps*200, reward: cps * 300, rarity: "Rare" }
    ];
  }

  window.buyB = (id) => {
    const b = buildings.find(x => x.id === id);
    const count = buyMode === "x10" ? 10 : 1;
    const cost = costOfN(b, count);
    if (coins >= cost) { coins -= cost; b.owned += count; updateUI(); }
  };

  window.startQ = (id) => {
    questState.active = questState.choices.find(c => c.id === id);
    questState.active.baseline = questState.active.type === "click" ? totalClicks : lifetimeEarned;
    updateUI();
  };

  document.getElementById("clickBtn").onclick = (e) => {
    const gain = perClick * getMult();
    coins += gain; lifetimeEarned += gain; totalClicks++;
    const pop = document.createElement("div");
    pop.className = "pop"; pop.textContent = "+" + fmt(gain);
    pop.style.left = e.clientX - 50 + "px"; pop.style.top = e.clientY - 50 + "px";
    document.body.appendChild(pop);
    setTimeout(() => pop.remove(), 700);
    updateUI();
  };

  document.getElementById("buyClickBtn").onclick = () => {
    if (coins >= clickUpgradeCost) {
      coins -= clickUpgradeCost; clickUpgrades++; perClick++;
      clickUpgradeCost = Math.ceil(clickUpgradeCost * 1.6);
      updateUI();
    }
  };

  document.getElementById("claimQuestBtn").onclick = () => {
    coins += questState.active.reward;
    questState.active = null; questState.choices = null;
    questState.readyAt = Date.now() + 30000;
    updateUI();
  };

  document.getElementById("btnX1").onclick = () => { buyMode="x1"; setPill("btnX1"); };
  document.getElementById("btnX10").onclick = () => { buyMode="x10"; setPill("btnX10"); };
  document.getElementById("btnMax").onclick = () => { buyMode="max"; setPill("btnMax"); };
  function setPill(id) {
    document.querySelectorAll(".pill").forEach(p => p.classList.remove("active"));
    document.getElementById(id).classList.add("active");
    updateUI();
  }

  function save() {
    localStorage.setItem(SAVE_KEY, JSON.stringify({ coins, perClick, clickUpgrades, clickUpgradeCost, prestigePoints, buildings, manualUnlocked, lifetimeEarned, totalClicks, questState }));
  }
  function load() {
    const saved = localStorage.getItem(SAVE_KEY);
    if (saved) {
      const d = JSON.parse(saved);
      coins = d.coins; perClick = d.perClick; clickUpgrades = d.clickUpgrades;
      clickUpgradeCost = d.clickUpgradeCost; prestigePoints = d.prestigePoints;
      buildings = d.buildings; manualUnlocked = d.manualUnlocked || {};
      lifetimeEarned = d.lifetimeEarned || 0; totalClicks = d.totalClicks || 0;
      questState = d.questState || questState;
    }
  }

  document.getElementById("saveBtn").onclick = save;
  document.getElementById("resetBtn").onclick = () => { if(confirm("Nollaa peli?")) { localStorage.clear(); location.reload(); }};

  initShop();
  load();
  setInterval(() => {
    const sGain = (getCps() * getMult()) / 10;
    coins += sGain; lifetimeEarned += sGain;
    updateUI();
  }, 100);

})();
</script>
</body>
</html>
